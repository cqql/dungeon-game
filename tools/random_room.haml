:ruby
  # The room maps
  # 0 - just a tile
  # 1 - wall
  # 2 - enemy
  # 3 - save point
  #
  # You will always spawn in the top left and the teleporter to the next room will be in the bottom right.
  # There could also be NPCs and merchants next your spawn point or the teleporter so leave some space around there.

  room1 = <<-ROOM1
  00000000000000000000
  00000000000000000000
  00000000000000000000
  00000000000000000000
  00000000000000000000
  00000000000000000000
  00000020000000000000
  00000020000000000000
  00000000000000000000
  00000020000000000000
  00000000000000000000
  00000000000010000000
  00000200000010000000
  00000000000010000000
  00000000000011110000
  00000000000000010000
  00000000000000010000
  00000000000000010000
  00000000000000010000
  00000000000000010000
  ROOM1

  room2 = <<-ROOM0
  00000000000000000000
  00000000000000000000
  00000000000000000000
  00000000000000000000
  00000000000000000000
  00000000000000000000
  00000000000000000000
  00000000000000000000
  00000000000000000000
  00000000000000000000
  00000000000000000000
  00000000000000000000
  00000000000000000000
  00000000000000000000
  00000000000000000000
  00000000000000000000
  00000000000000000000
  00000000000000003000
  00000000000000000000
  00000000000000000000
  ROOM0

  room3 = <<-ROOM0
  00000000000000000000
  00000000000000000000
  00000000000000000000
  00000000000000000000
  00000000000000000000
  00000000000000000000
  00000000000000000000
  00000000000000000000
  00000000000000000000
  00000000000000000000
  00000000000000000000
  00000000000000000000
  00000000000000000000
  00000000000000000000
  00000000000000000000
  00000000000000000000
  00000000000000000000
  00000000000000000000
  00000000000000000000
  00000000000000000000
  ROOM0

  room4 = <<-ROOM0
  00000000000000000000
  00000000000000000000
  00000000000000000000
  00000000000000000000
  00000000000000000000
  00000000000000000000
  00000000000000000000
  00000000000000000000
  00000000000000000000
  00000000000000000000
  00000000000000000000
  00000000000000000000
  00000000000000000000
  00000000000000000000
  00000000000000000000
  00000000000000000000
  00000000000000000000
  00000000000000000000
  00000000000000000000
  00000000000000000000
  ROOM0

  room5 = <<-ROOM0
  00000000000000000000
  00000000000000000000
  00000000000000000000
  00000000000000000000
  00000000000000000000
  00000000000000000000
  00000000000000000000
  00000000000000000000
  00000000000000000000
  00000000000000000000
  00000000000000000000
  00000000000000000000
  00000000000000000000
  00000000000000000000
  00000000000000000000
  00000000000000000000
  00000000000000000000
  00000000000000000000
  00000000000000000000
  00000000000000000000
  ROOM0

  room6 = <<-ROOM0
  00000000000000000000
  00000000000000000000
  00000000000000000000
  00000000000000000000
  00000000000000000000
  00000000000000000000
  00000000000000000000
  00000000000000000000
  00000000000000000000
  00000000000000000000
  00000000000000000000
  00000000000000000000
  00000000000000000000
  00000000000000000000
  00000000000000000000
  00000000000000000000
  00000000000000000000
  00000000000000000000
  00000000000000000000
  00000000000000000000
  ROOM0

  room7 = <<-ROOM0
  00000000000000000000
  00000000000000000000
  00000000000000000000
  00000000000000000000
  00000000000000000000
  00000000000000000000
  00000000000000000000
  00000000000000000000
  00000000000000000000
  00000000000000000000
  00000000000000000000
  00000000000000000000
  00000000000000000000
  00000000000000000000
  00000000000000000000
  00000000000000000000
  00000000000000000000
  00000000000000000000
  00000000000000000000
  00000000000000000000
  ROOM0

  room8 = <<-ROOM0
  00000000000000000000
  00000000000000000000
  00000000000000000000
  00000000000000000000
  00000000000000000000
  00000000000000000000
  00000000000000000000
  00000000000000000000
  00000000000000000000
  00000000000000000000
  00000000000000000000
  00000000000000000000
  00000000000000000000
  00000000000000000000
  00000000000000000000
  00000000000000000000
  00000000000000000000
  00000000000000000000
  00000000000000000000
  00000000000000000000
  ROOM0

  room9 = <<-ROOM0
  00000000000000000000
  00020001111000000000
  00000001111000000000
  00000000000011111100
  00001000000000000000
  00001000000000000000
  00001001111111100100
  00001000000000100100
  00001000000020100100
  00001111110000100000
  00000000010000100000
  00000000010000100100
  00000000000000100100
  00111110010000100100
  00100000010000100000
  00100000010000100000
  00100220000000100000
  00100000000000100000
  00111111111111100300
  00000000000000000000
  ROOM0

  @_next_id = 100

  def next_id
    @_next_id = @_next_id + 1

    @_next_id
  end

  def string_to_map string
    string.lines.map(&:chars).map { |line| line.select { |char| char != "\n" } }.map { |line| line.map(&:to_i) }
  end

  def room id, map
    tiles = []
    enemies = []
    save_points = []

    map.each_with_index do |row, y|
      row.each_with_index do |column, x|
        if column == 1
          tiles << { x: x * 1000, y: y * 1000, blocking: true }
        elsif column == 0
          tiles << { x: x * 1000, y: y * 1000, blocking: false }
        elsif column == 2
          enemies << { id: next_id(), x: x * 1000, y: y * 1000, hp: Random.rand(8) + 2, speed: 1000, move_strategy: "NORMAL" }
          tiles << { x: x * 1000, y: y * 1000, blocking: false }
        elsif column == 3
          save_points << { x: x * 1000, y: y * 1000 }
          tiles << { x: x * 1000, y: y * 1000, blocking: false }
        end
      end
    end

    {
      id: id,
      tiles: tiles,
      enemies: enemies,
      teleporters: [],
      save_points: save_points,
      npcs: [],
      merchants: []
    }
  end

  def teleporter room, x, y, target_room, target_x, target_y
    room[:teleporters] << { x: x * 1000, y: y * 1000, target_id: target_room, target_x: target_x, target_y: target_y }

    room
  end

  def boss room, x, y, hp, speed, on_death
    room[:enemies] << { id: next_id(), x: x * 1000, y: y * 1000, hp: hp, speed: speed, move_strategy: "TELEPORT", on_death: on_death }

    room
  end

  def npc room, x, y, name, saying
    room[:npcs] << { id: next_id(), x: x * 1000, y: y * 1000, name: name, saying: saying}

    room
  end

  def merchant room, x, y, money, items
    room[:merchants] << { id: next_id(), x: x * 1000, y: y * 1000, money: money, items: items}

    room
  end

  levels = [
    {
      id: "level-1",
      rooms: [
        npc(teleporter(room("room-1", string_to_map(room1)), 19, 19, "room-2", 0, 0), 3, 0, "Wächter", "Willkommen im alten Schloss"),
        merchant(teleporter(room("room-2", string_to_map(room2)), 19, 19, "room-3", 0, 0), 16, 19, 10, [{id: next_id(), type: "HEALTH_POTION"}, {id: next_id(), type: "HEALTH_POTION"}]),
        boss(room("room-3", string_to_map(room3)), 15, 7, 15, 1500, "level-2#room-4")
      ]
    },
    {
      id: "level-2",
      rooms: [
        npc(teleporter(room("room-4", string_to_map(room4)), 19, 19, "room-5", 0, 0), 3, 0, "Wächter", "Oh, du hast es ja sogar bis in den zweiten Stock geschafft"),
        merchant(teleporter(room("room-5", string_to_map(room5)), 19, 19, "room-6", 0, 0), 16, 19, 10, [{id: next_id(), type: "HEALTH_POTION"}, {id: next_id(), type: "WEAK_BOW"}]),
        boss(room("room-6", string_to_map(room6)), 15, 7, 30, 1500, "level-3#room-7")
      ]
    },
    {
      id: "level-3",
      rooms: [
        npc(teleporter(room("room-7", string_to_map(room7)), 19, 19, "room-8", 0, 0), 3, 0, "Wächter", "Man sagt, dass im hintersten Zimmer ein Geist den Schlüssel zu großen Ruhm bewacht"),
        merchant(teleporter(room("room-8", string_to_map(room8)), 19, 19, "room-9", 0, 0), 16, 19, 10, [{id: next_id(), type: "HEALTH_POTION"}, {id: next_id(), type: "STRONG_BOW"}]),
        boss(room("room-9", string_to_map(room9)), 15, 7, 40, 1500, "VICTORY")
      ]
    }
  ]

- levels.each do |level|
  %level{id: level[:id]}
    - level[:rooms].each do |room|
      %room{id: room[:id]}
        - room[:tiles].each do |tile|
          %tile{blocking: tile[:blocking] ? "true" : "false"}
            %position{x: tile[:x], y: tile[:y]}
        - room[:enemies].each do |enemy|
          %enemy{id: enemy[:id], hitPoints: enemy[:hp], speed: enemy[:speed], moveStrategy: enemy[:move_strategy], onDeath: enemy[:on_death]}
            %position{x: enemy[:x], y: enemy[:y]}
        - room[:teleporters].each do |teleporter|
          %teleporter{blocking: "false"}
            %position{x: teleporter[:x], y: teleporter[:y]}
            %target{roomId: teleporter[:target_id], x: teleporter[:target_x], y: teleporter[:target_y]}
        - room[:save_points].each do |save_point|
          %save-point
            %position{x: save_point[:x], y: save_point[:y]}
        - room[:merchants].each do |merchant|
          %merchant{id: merchant[:id], money: merchant[:money]}
            %position{x: merchant[:x], y: merchant[:y]}
            - merchant[:items].each do |item|
              %item{id: item[:id], type: item[:type]}
        - room[:npcs].each do |npc|
          %npc{id: npc[:id], name: npc[:name], saying: npc[:saying]}
            %position{x: npc[:x], y: npc[:y]}
